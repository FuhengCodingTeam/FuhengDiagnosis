<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--  -->
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
    <title>Success</title>

</head>

<body>
    <header>
        <h2>Welcome to A.I. Diagnosis</h2>
        <div class="row align-items-center">
            <a class="col-md-auto" href="/">Home</a>
            <a class="col-md-auto" href="">How it Works</a>
            <a class="col-md-auto" href="">Contact Us</a>

        </div>
    </header>
    <div class="wrapper">
        <div id="info" style="display: block;">
            <center>
                <h3>Patient: {{patient.firstName}} {{patient.lastName}} </h3>
                <h3>Case Number: <span>{{patient.caseNumber}}</span></h3>
                <a class="btn btn-primary" href="">Send your diagnosis to your email</a>
            </center>



        </div>

        {% if not patient.diagnosisResult %}
        <!--  -->
        {% if patient.agreementCheck == False %}
        <div class="form2-1">
            <h4>Before you start A.I.Diagnosis</h4>
            <h5>Please carefully review the instruction and terms agreements</h5>
            <form action="/agreementCheck/{{patient.id}}" method="POST">
                {% csrf_token %}
                <h4>Instruction</h4>
                <p>Lorem ipsum, dolor sit amet consectetur adipisicing elit. Fugit impedit cum dicta commodi laboriosam libero quos quidem culpa harum possimus, nemo nisi eaque quas, minus rem a placeat tenetur odio.</p>
                <input type="checkbox" name="agreementCheck" id="agreementCheck" value="T" onchange="document.getElementById('submit').disabled = !this.checked;">
                <label for="agreementCheck">By checking this ...</label>
                <button type="submit" class="btn btn-primary" id="submit" disabled>Submit</button>
            </form>
        </div>
        {% else %}
        <script>
            function move() {
                var elem = document.getElementById("progressBar");
                var width = 0;
                var id = setInterval(frame, 500);
                var form = document.getElementById("diaForm")

                function frame() {
                    if (width >= 100) {
                        clearInterval(id);
                        document.getElementById("show-result").style.display = "block";
                        document.getElementById("diaMessage").style.display = "none";
                        document.getElementById("diaComplete").style.display = "block";
                        document.getElementById("info").style.display = "block";
                        document.getElementById("diaImg1").style.display = "none";
                        document.getElementById("diaImg2").style.display = "block";

                        // set page to auto redirect to new page
                        setTimeout(function() {
                            form.submit();
                        }, 5000);
                    } else {
                        width++;
                        elem.style.width = width + '%';
                        document.getElementById("progress").innerHTML = width * 1 + '%';
                        document.getElementById("diaButton").style.display = "none";
                        document.getElementById("diaMessage").style.display = "block";
                        document.getElementById("info").style.display = "none";
                        document.getElementById("diaImg1").style.display = "block";

                    }
                }
            }
        </script>

        <div class="form2-1">
            <center id="diaImg1" style="display: none;">
                <img src="/media/systemPhotos/warning.png" alt="">
            </center>
            <center id="diaImg2" style="display: none;">
                <img src="/media/systemPhotos/success.png" style="height: 320px; width: 320px;" alt="">
            </center>
            <h5>Patient:</h5>
            <h6>Review your information</h6>
            <br>
            <center>
                <button class="btn btn-warning" id="diaButton" onclick="move()">Start Diagnosis</button>
            </center>
            <br>
            <div class="" style="background-color: rgba(232, 232, 232, 0.735);">
                <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated" style="height:30px;width:0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                    <p id="progress">0%</p>
                </div>
            </div>
            <center>
                <div id="diaMessage" style="display: none;">
                    <h4>Do Not Close or Refreash the Broswer!! </h4>
                    <h4>Your diagnosis is in progressing.</h4>
                    <br>
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <strong id="diaComplete" style="display: none;">Complete!</strong>
                </div>

                <div id="show-result" style="display:none">
                    <h4>Your diagnosis result is Completed! </h4>
                    <h4>Loading your result...Please wait</h4>
                    <h5>Page not reload?
                        <a href="/patient/{{patient.id}}/seeResult/page">click here to view your result</a>
                    </h5>
                </div>
            </center>
            <form id="diaForm" action="/patient/{{patient.id}}/seeResult" method="POST">
                {% csrf_token %}
                <button class="btn btn-success" style="display: none;">See Result</button>
            </form>

            {% endif %}
            <!--  -->
            {% else %}
            <p>See result</p>
            <script>
                window.location.replace("/patient/{{patient.id}}/seeResult/page")
            </script>
            <a href="/patient/{{patient.id}}/seeResult/page">See result</a>
            <!--  -->
            {% endif %}
        </div>
    </div>
</body>
<footer>
    <center>
        <h2>Footer</h2>
    </center>
</footer>

</html>